#!/usr/bin/env nu

source scripts/environments.nu
source scripts/fluxcd.nu
source scripts/github.nu
source scripts/kubernetes.nu

def main [] {
    platform --help
}

def "main setup" [] {

    rm --force .env

    let token = (main get github)
    let environment = (main get environment)

    $env.GITHUB_TOKEN = $token.token

    (
        main create kubernetes
            --environment $environment
    )

    (
        main apply fluxcd
           --environment $environment   
    )
}

# Hello World
def "main hello" [] {

    let environment = (main get environment)
    print $environment

}
